machine:
  services:
    - docker

dependencies:
  override:
    - docker info
    - cd lite && docker build -t .
    - cd ../full && docker build -t full .

test:
  override:
    - echo

deployment:
  hub:
    branch: /^.*/
    commands:
      - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS quay.io
      - |
        PROJECT_TAG="latest"
        if [[ "$CIRCLE_BRANCH" != "master" ]]; then
          PROJECT_TAG="${CIRCLE_BRANCH}"
        fi
      - docker tag lite quay.io/vektorcloud/mesos:${PROJECT_TAG}
      - docker tag lite quay.io/vektorcloud/mesos:${PROJECT_TAG}-lite
      - docker tag full quay.io/vektorcloud/mesos:${PROJECT_TAG}-full
      - docker push quay.io/vektorcloud/mesos:${PROJECT_TAG}
      - docker push quay.io/vektorcloud/mesos:${PROJECT_TAG}-lite
      - docker push quay.io/vektorcloud/mesos:${PROJECT_TAG}-full
